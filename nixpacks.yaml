# Nixpacks configuration file
# Compatible with Railway's Nixpacks or a similar system.
nixpacks:
  version: "0.1"
  channel: "stable-24.05" # Specify the Nix channel version

# Explicitly set the provider to Node.js
providers:
  - node
  
dependencies:
  # Specify packages from nixpkgs
  nix:
    - nodejs_20
    - silver-searcher

commands:
  # Commands to run during the build phase
  build: |
    npm --prefix ./client run build
    echo "Build complete."

  # Commands to run when the app starts
  start: |
    npm --prefix ./server run start

environment:
  # Set environment variables
  NODE_ENV: "production"
  HOST: "0.0.0.0"

extensions:
  # VS Code extensions (replace with your desired extensions)
  - vscodevim.vim

workspace:
  # Actions for workspace lifecycle
  onCreate:
    - echo "Workspace created."
    - echo -e "alias ga='git add'" >> ~/.bash_aliases
    - echo -e "alias gcm='git commit --message'" >> ~/.bash_aliases
    - echo -e "alias gs='git status'" >> ~/.bash_aliases

  onStart:
    - npm --prefix ./server run dev
    - echo "Workspace restarted. Aliases set."

previews:
  # Configure previews for the workspace
  enable: true
  web:
    command: |
      sleep 5
      npm --prefix ./client run dev -- --port $PORT --host 0.0.0.0
    manager: "web"