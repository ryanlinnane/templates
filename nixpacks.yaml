# Nixpacks configuration file
# Compatible with Railway's Nixpacks or a similar system.
nixpacks:
  version: "0.1"
  channel: "stable-24.05" # Specify the Nix channel version

# Explicitly set the provider to Node.js
providers:
  - node

dependencies:
  # Specify packages from nixpkgs
  nix:
    - nodejs_20
    - silver-searcher

commands:
  # Commands to run during the build phase
  build: |
    npm --prefix ./client install
    npm --prefix ./client run build
    npm --prefix ./server install
    echo "Build complete."

  # Commands to run when the app starts
  start: |
    npm --prefix ./server run start

environment:
  # Set environment variables
  NODE_ENV: "production"
  HOST: "0.0.0.0"